<div class="product-carousel-wrapper">
  <button class="owl-prev-custom"><i class="fa fa-angle-left"></i></button>

  <div class="owl-carousel">
    {% for product in section.settings.collection.products %}
      {% assign first_variant = product.variants.first %}
      {% assign original_price = first_variant.compare_at_price %}
      {% assign sale_price = first_variant.price %}

      <div class="item product-card">
        <a href="{{ product.url }}">
          <div class="image-wrapper">
            {% if original_price > sale_price %}
              {% assign discount = 100 | times: sale_price | divided_by: original_price | minus: 100 | round %}
              <div class="sale-badge">{{ discount | abs }}% OFF</div>
            {% endif %}
            <img
              srcset="
                {%- if product.featured_media.width >= 165 -%}{{ product.featured_media | image_url: width: 165 }} 165w,{%- endif -%}
                {%- if product.featured_media.width >= 360 -%}{{ product.featured_media | image_url: width: 360 }} 360w,{%- endif -%}
                {%- if product.featured_media.width >= 533 -%}{{ product.featured_media | image_url: width: 533 }} 533w,{%- endif -%}
                {%- if product.featured_media.width >= 720 -%}{{ product.featured_media | image_url: width: 720 }} 720w,{%- endif -%}
                {%- if product.featured_media.width >= 940 -%}{{ product.featured_media | image_url: width: 940 }} 940w,{%- endif -%}
                {%- if product.featured_media.width >= 1066 -%}{{ product.featured_media | image_url: width: 1066 }} 1066w,{%- endif -%}
                {{ product.featured_media | image_url }} {{ product.featured_media.width }}w
              "
              src="{{ product.featured_media | image_url: width: 533 }}"
              sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
              alt="{{ product.featured_media.alt | escape }}"
              class="motion-reduce"
              {% unless lazy_load == false %}
                loading="lazy"
              {% endunless %}
              width="{{ product.featured_media.width }}"
              height="{{ product.featured_media.height }}"
            >
          </div>
          {% comment %}
            <div class="product-info">
              <p class="product-title">{{ product.title }}</p>
              <div class="product-price">
                <span class="sale-price">{{ sale_price | money }}</span>
                {% if original_price > sale_price %}
                  <span class="compare-price">{{ original_price | money }}</span>
                {% endif %}
              </div>
            </div>
          {% endcomment %}
          <div class="arrival-content">
            <ul class="list-inline">
              <li>
                <h4 style="margin:0;">
                  <a href="{{ product.url }}">{{ product.title }}</a>
                </h4>
              </li>
              <li class="product-price">
                <h4 class="sale-price">{{ sale_price | money }}</h4>
                {% if original_price > sale_price %}
                  <h4 class="compare-price">{{ original_price | money }}</h4>
                {% endif %}
                <div class="color-price"></div>
              </li>
            </ul>
          </div>
        </a>
      </div>
      {% if original_price > sale_price %}
        {% assign discount = 100 | times: sale_price | divided_by: original_price | minus: 100 | round %}
        <div class="flag-sale d-flex">
          <div class="flag-product sale">sale</div>
          <div class="flag-product off">{{ discount | abs }}%</div>
        </div>
      {% endif %}
    {% endfor %}
  </div>

  <button class="owl-next-custom"><i class="fa fa-angle-right"></i></button>
</div>

<style>
  .product-carousel-wrapper {
    position: relative;
    padding: 20px 40px;
  }

  .owl-carousel .item {
    text-align: center;
    padding: 10px;
  }

  .owl-carousel .item img {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto 10px;
  }

  .owl-prev-custom,
  .owl-next-custom {
    position: absolute;
    cursor: pointer;
    font-size: 24px;
    line-height: 24px;
    width: 30px;
    height: 30px;
    top: calc(50% - 15px);
    margin-top: 0;
    padding: 0;
    color: #fff;
    border: none !important;
    border-radius: 0;
    background-color: #020203;
    outline: 0 !important;
    z-index: 99;
    opacity: 0.6;
  }

  .owl-prev-custom {
    left: 53px;
  }

  .owl-next-custom {
    right: 53px;
  }

  .owl-prev-custom:hover,
  .owl-next-custom:hover {
    opacity: 1;
    background-color: #be1623;
  }

  .owl-prev-custom,
  .owl-next-custom {
    transition: all 0.4s ease-in-out;
  }

  .product-card {
    text-align: center;
    padding: 10px;
    position: relative;
  }

  .image-wrapper {
    position: relative;
  }

  .sale-badge {
    position: absolute;
    top: 8px;
    left: 8px;
    background: none;
    color: #d00;
    font-weight: bold;
    font-size: 14px;
  }

  .product-info {
    margin-top: 10px;
  }

  .product-title {
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    margin-bottom: 6px;
  }

  .product-price {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
  }

  .sale-price {
    font-size: 16px;
    font-weight: 500;
    color: #111;
  }

  .compare-price {
    font-size: 14px;
    color: #888;
    text-decoration: line-through;
  }

  .arrival-content {
    padding: 1rem 4px !important;
  }

  .arrival-content .list-inline {
    gap: 5px;
    min-height: 42px;
    display: flex;
    justify-content: space-between;
    margin: 0;
  }

  .arrival-content ul li:last-child {
    text-align: right;
  }
  .product-price {
    position: relative;
  }
  .product-price {
    min-width: 100px;
  }

  .color-image,
  .color-price {
    opacity: 0;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #fff;
  }

  .flag-sale.d-flex {
    background-color: transparent;
    border: none;
  }
  .product-grid .flag-sale,
  .flag-sale {
    display: block !important;
    margin: 0;
    text-align: center;
    border: solid 2px #d61f2e;
    width: 12%;
    min-width: 40px;
    top: 10px;
    left: 20px;
    padding: 0px;
    background: #d61f2e;
    position: absolute;
    top: 0;
    right: 0;
    margin: 21px;
    background: none;
    border: none;
    min-width: 55px;
    margin-left: 0;
  }
  .flag-sale {
    top: 9px;
    z-index: 99;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var $carousel = $('.owl-carousel');

    $carousel.owlCarousel({
      loop: true,
      margin: 10,
      nav: false,
      dots: false,
      autoplay: true,
      autoplayTimeout: 3000,
      autoplayHoverPause: true,
      smartSpeed: 600,
      responsive: {
        0: {
          items: 1,
        },
        480: {
          items: 2,
        },
        768: {
          items: 3,
        },
        1024: {
          items: 4,
        },
      },
    });

    $('.owl-prev-custom').on('click', function () {
      $carousel.trigger('prev.owl.carousel');
    });

    $('.owl-next-custom').on('click', function () {
      $carousel.trigger('next.owl.carousel');
    });
  });
</script>

{% schema %}
{
  "name": "Product Carousel",
  "settings": [
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    }
  ],
  "presets": [
    {
      "name": "Product Carousel"
    }
  ]
}
{% endschema %}
